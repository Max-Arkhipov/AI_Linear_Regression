# AI_Linear_Regression
HW project ( 2024, ML course). With all sorts of linear models and FastApi service.

## Результаты работы

### Предобработка данных и EDA

- В первую очередь был осуществлен первичный анализ данных: вывели различные части датасета, определили типы полей и наличие в них пропусков, вывели список полей с пропусками. Кроме того, с помощью библиотеки ydata_profiling создали отчет, вывели его на экран, сохрнили в файл profile_report.html.

- Далее была проведена обработка полей mileage, engine, max_power, torque: очистили их от единиц измерения и привели к числовым типам. При реализации были написаны функции с использованием методов обработки строк. 

- С признаком torque вышла забавная ситуация, сначала я его удалил, но после того, как получил неудовлетворительные метрики качества построенных моделей, решил с ним все-таки разобраться. Torque очень неприянтый признак, у него есть два значения с разными единицами
 измерения, которые еще и отличаются от строки к строке. Чтобы с ним разобраться, пишем отдельную функцию, которая преобразуют колонку в torque и max_torque_rpm с конвертированными и округленными данными для различных единиц измерения. 

- После заполнили пропуски в полях тренировочного и тестового датасета медианными значениями по столбцам тренировочного датасета. При реализации использовались функции и циклы.

- Удалили из тренировочного датасета объекты с одинаковым признаковым описанием, обновили индексы строк.

- Построили графики `pairplot` из библиотеки `seabron` для тренировочного и тестового датасета. Были сделаны следующие выводы:
    - На основе распределений можно предположить связь признаков с целевой переменной, в особенности сильную связь можно наблюдать для признаков: year, engine, max_power и km_driven. Связь признаков engine и max_power с целевой переменной скорее всего линейная. Зависимость между признаками year, km_driven и целевой переменной выглядит квадратичной.
    - На основе распределений можно выдвинуть гипотезу о корреляциях признаков: engine, mileage, max_power, seats.
      
- Построили тепловую карту `heatmap` из библиотеки `seabron` для отображения корреляций тренировочного датасета. Из тепловой карты следует, что наибольшая зависимость наблюдается между таргетом и признаком max_power. На тепловой карте подтверждается зависимость между признаками engine - seats, engine - max_power.

- Для того, чтобы сравнить распределения тестового и тренировочного набора данных построены дополнительные графики отображающие данные на одном графическом элементе, кроме того в анализ включены категориальные признаки. Некоторые выводы:
    - Данные на гистограмме позволяют предположить схожесть распределения признаков датасетов, однако для распределения автомобилей по году производства можно заметить, что в тренировочном датасете не представлены 2005, 2009 и 2015 годы выпуска автомобилей.
    - Данные, представленные на графике `kdeplot` библиотеки `seabron`, показывают высокую схожесть распределения признаков датасета.
    - При отображении на тепловой карте всех признаков модели можно заметить сильную корреляцию между наименованием марки автомобиля и таргетом

### Модель только на вещественных признаках

- Обучили классическую линейную регрессию. Получили результат:
    - начение MSE для трейна:  116845733702.86499
    - Значение MSE для теста:   233150131369.0009
    - Значение R^2 для трейна:  0.5923583203410302
    - Значение R^2 для теста:   0.5944005754723716
    - Модель далека от совершенства, предсказывает цену посредственно.

- Стандартизировали классическую линейную регрессию. Получили следующий результат:
    - Значение MSE для трейна:  116845733702.8652
    - Значение MSE для теста:   233150131368.99503
    - Значение R^2 для трейна:  0.5923583203410294
    - Значение R^2 для теста:   0.5944005754723818
    - Каких-либо значимых изменений качества модели стандартизация не дала
    - Наиболее информативным оказался признак max_power.
    - Проведена стандартизация признаков, последующие модели на вещественных признаках обучаются на них.
      
- Обучили Lasso-регрессию:
    - Значение MSE для трейна:  116600313600.87555
    - Значение MSE для теста:   233001786510.72232
    - Значение R^2 для трейна:  0.5932145215854115
    - Значение R^2 для теста:   0.5946586434768635
    - Качество модели практически не изменилось
    - L1-регуляризация с параметрами по умолчанию не занулила никакие веса

- Перебором по сетке (c 10-ю фолдами) подобрали оптимальные параметры для Lasso-регрессии:
    - Получили: alpha = 55300
    - Значение MSE для трейна:  124199197326.72923
    - Значение MSE для теста:   268526387418.06036
    - Значение R^2 для трейна:  0.5667041679133009
    - Значение R^2 для теста:   0.5328583022118372
    - При регуляризации занулились веса следующих признаков: km_driven, mileage, engine, seats
      
- Перебором по сетке (c 10-ю фолдами) подобрали оптимальные параметры для ElasticNet-регрессии:
    - Получили: alpha = 0.76, l1_ratio = 0.49
    - Значение MSE для трейна:  126195023419.74557
    - Значение MSE для теста:   278928918851.4617
    - Значение R^2 для трейна:  0.5597412957990885
    - Значение R^2 для теста:   0.5147615473944854
    - Получаем: alpha = 0.96, l1_ratio=0.86 


### Добавляем категориальные фичи

- Обработали поле name, оставили только марку автомобиля.
- Закодировали категориальные фичи (и seats) методом OneHot-кодирования
- В тренировочном датасете не хватает производетелей Opel и Ashok.
- Поскольку Maruti представлен больше других в обоих частях датасета, изменим две строчки на нужные нам марки
- Подобрали параметр регуляризации alpha для гребневой (ridge) регрессии:
    - Получаем: alpha = 548.1
    - Значение MSE для трейна:  65761755414.271454
    - Значение MSE для теста:   126150814311.29364
    - Значение R^2 для трейна:  0.7705758560037296
    - Значение R^2 для теста:   0.7805418449137729
    - Качество предсказаний значительно улучшилось

### Решаем бизнес-задачу
- Бизнес-модель: доля предсказаний, отличающихся не более чем на 10% от реальной цены.

- Модель:  Линейная регрессия
    - Значение BM для трейна:  0.21575342465753425
    - Значение BM для теста:   0.226
      
- Модель:  Линейная регрессия со стандартизированными параметрами
    - Значение BM для трейна:  0.21575342465753425
    - Значение BM для теста:   0.226
 
- Модель:  Lasso()
    - Значение BM для трейна:  0.21575342465753425
    - Значение BM для теста:   0.226

- Модель:  Lasso(alpha=55300)
    - Значение BM для трейна:  0.20753424657534247
    - Значение BM для теста:   0.237
 
- Модель:  ElasticNet(alpha=0.76, l1_ratio=0.49)
    - Значение BM для трейна:  0.22825342465753426
    - Значение BM для теста:   0.254
 
- Модель:  Ridge(alpha=548.1)
    - Значение BM для трейна:  0.2756849315068493
    - Значение BM для теста:   0.316
 
- Лучшей с точки зрения бизнес-модели является модель Ridge(alpha=548.1), построенная на категориальных признаках, для тестовых данных 31.6% предсказаний отличаются не более 10% от реальной цены.
